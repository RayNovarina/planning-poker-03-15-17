* TODO late comers become voters
** DONE write cucumber scenarios
** DONE change something in the model so that we can identify who is the animator (vs voters)
*** If no one is animator for the team, elect this member
*** Should be some kind of optimistic lock to avoid race conditions
*** Could be create as voter, then update animator = 1 where count(animators) == 0
*** Otherwise, just add an animator id to the team table, locking will be more straightforward
*** Could I use rails' sql dsl for that ?
*** Also check if there is something for optimistic locking in rails
*** Rails has something for optimistic locking, so it might work out of the box
*** This needs to be tested accross different sessions
*** DONE add a nullable 'animator_id' field to Team model, default it to null
**** DONE model
**** DONE migration
**** DONE commit
** DONE in team member controller, at create, upgrade the team mate to animator if there is no animator in the team
*** DONE add tests for existing post
*** DONE add a transaction or something between tests to delete existing data from the db (why not use sqlite at the same time !)
*** DONE add a test with a new team and member (needs previous action)
** DONE display a different page for voters and animators
*** DONE add tests for show
*** DONE create a new view
** DONE add a test to fail it with multiple sessions
*** What can happen ?
**** 2 people get registered as animator
**** the latest overwrites the first ... is this so much of an issue ?
**** At worst, both are displayed as animators. that should be fixed
*** DONE experiment with the console and rails' optimistic locking to make sure no one will break the thing
*** DONE write a test on models to check that
*** DONE add the fix to the code
**** DONE add a migration for lock_version column
**** DONE move the code to the model
**** DONE execute the update every time (skip the if) and catch the exception
** TODO move to hexagonal model ?
*** Moved the if_needed_pick_animator to Team. Great.
*** I now have tests in controller which are redundant with the ones I should write in Team_spec.rb
*** If the Team was well encapsulated, I could be sure that the only way to change it is through this method !
*** => It would be better to move to hexagonal model !
** TODO setup FactoryGirl for testing
** TODO Have a look at how to emit raw sql in rails (or using this sql ast Sylvain talked about)
** TODO Find a way to factorize code between voter / animator specs and views
** TODO would it be simpler with rspec proxies ?
** TODO add a button to takeover animatorship
** TODO add DB primary key on team(name), and team_members(name,team)
** TODO how to run and access gem server through docker ?
** TODO Blog post update about how I setup sqlite3 in test
